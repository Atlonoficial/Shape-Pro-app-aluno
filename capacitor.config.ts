// capacitor.config.ts
import type { CapacitorConfig } from "@capacitor/cli";

const serverUrl = (process.env.VITE_CAP_SERVER_URL || "").trim();

const config: CapacitorConfig = {
  appId: "com.atlontech.shapepro.aluno",
  appName: "Shape Pro",
  webDir: "dist",
  bundledWebRuntime: false,
  backgroundColor: "#000000",

  // Em PRODU√á√ÉO deixe serverUrl vazio (s√≥ use em DEV/hot-reload)
  ...(serverUrl
    ? {
        server: {
          url: serverUrl,
          cleartext: true,
        },
      }
    : {}),

  ios: {
    scheme: "ShapePro",
    contentInset: "automatic",
    backgroundColor: "#000000",
    allowsLinkPreview: false,
    handleApplicationNotifications: false,

    // üîë Entradas que v√£o para o Info.plist do App (obrigat√≥rias p/ Apple)
    plist: {
      // ---- Privacidade (evita ITMS-90683) ----
      NSPhotoLibraryUsageDescription:
        "Precisamos acessar suas fotos para voc√™ escolher imagens de perfil e anexar comprovantes no app.",
      NSPhotoLibraryAddUsageDescription:
        "Precisamos salvar imagens na sua galeria quando voc√™ exporta ou baixa m√≠dias pelo app.",
      NSCameraUsageDescription: "Precisamos da c√¢mera para tirar fotos dentro do app.",
      NSLocationWhenInUseUsageDescription:
        "Usamos sua localiza√ß√£o apenas enquanto o app est√° em uso para enviar notifica√ß√µes relevantes na sua regi√£o.",
      // Extra para silenciar scanners de localiza√ß√£o
      NSLocationAlwaysAndWhenInUseUsageDescription:
        "Usamos sua localiza√ß√£o somente quando necess√°rio para recursos do app.",

      // ---- Requisito do OneSignal (aviso que apareceu no build) ----
      UIBackgroundModes: ["remote-notification"],

      // ---- For√ßar nova vers√£o/build para o App Store Connect enxergar que √© bin√°rio novo ----
      CFBundleShortVersionString: "1.1.1", // vers√£o de marketing (mude se quiser)
      CFBundleVersion: "2", // n√∫mero do build (sempre incremente)
    },
  },

  android: {
    backgroundColor: "#000000",
    allowMixedContent: true,
    captureInput: true,
    webContentsDebuggingEnabled: false,
    appendUserAgent: "Shape Pro/1.0",
    overrideUserAgent: "Shape Pro/1.0 Mobile App",
    hideLogs: true,
    cleartext: true,
    networkSecurityConfig: true,
  },

  plugins: {
    PushNotifications: {
      presentationOptions: ["badge", "sound", "alert"],
    },
    SplashScreen: {
      launchAutoHide: true,
      launchShowDuration: 0,
      backgroundColor: "#000000",
      androidSplashResourceName: "splash",
      androidScaleType: "CENTER",
      showSpinner: false,
      iosSpinnerStyle: "small",
      spinnerColor: "#999999",
    },
    Keyboard: {
      resize: "body",
      style: "dark",
      resizeOnFullScreen: true,
    },
    StatusBar: {
      style: "dark",
      backgroundColor: "#000000",
    },
    Camera: {
      permissions: ["camera", "photos"],
    },
  },
};

export default config;
